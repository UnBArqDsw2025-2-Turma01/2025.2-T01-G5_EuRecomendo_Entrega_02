# 2.3. Especificação Completa de Arquitetura de Modelos para Django

## 1. Visão Geral

Este documento fornece a especificação técnica detalhada para a implementação da camada de modelo (Model Layer) da aplicação "EuRecomendo" utilizando o framework Django. Ele traduz os diagramas de classe em uma estrutura de código Django concreta, servindo como um blueprint para os desenvolvedores.

A arquitetura se baseia em princípios de código limpo, reutilizável e manutenível, como o uso de modelos abstratos (DRY), managers personalizados para lógica de consulta complexa e uma separação clara de responsabilidades.

---

## 2. Modelos Abstratos (App `core`)

### 2.1. Classe: `TimestampedModel`

-   **Descrição:** Modelo abstrato base que adiciona campos de timestamp de criação e atualização a todos os modelos concretos que o herdam. Garante um padrão de auditoria consistente em todo o sistema.
-   **Herança:** `django.db.models.Model`
-   **Meta:** `abstract = True`

#### Atributos (Campos)

| Nome do Atributo | Tipo de Campo Django        | Parâmetros                                                                 | Descrição                                                                |
| :--------------- | :-------------------------- | :------------------------------------------------------------------------- | :----------------------------------------------------------------------- |
| `created_at`     | `models.DateTimeField`      | `verbose_name="Criado em"`, `auto_now_add=True`                            | Data e hora em que o registro foi criado. Preenchido automaticamente.    |
| `updated_at`     | `models.DateTimeField`      | `verbose_name="Atualizado em"`, `auto_now=True`                          | Data e hora da última atualização do registro. Atualizado automaticamente. |

---

## 3. Modelos da Aplicação `users`

### 3.1. Classe: `User`

-   **Descrição:** Modelo customizado que estende o usuário padrão do Django. Centraliza todas as informações e autenticação do usuário.
-   **Herança:** `django.contrib.auth.models.AbstractUser`

#### Atributos (Campos do `AbstractUser` a serem considerados)

| Nome do Atributo | Tipo de Campo Django      | Parâmetros Chave                                    | Descrição                                                                      |
| :--------------- | :------------------------ | :-------------------------------------------------- | :----------------------------------------------------------------------------- |
| `username`       | `models.CharField`        | `max_length=150`, `unique=True`, `...`              | Nome de usuário único para login.                                              |
| `email`          | `models.EmailField`       | `unique=True`, `verbose_name='endereço de e-mail'`  | Endereço de e-mail único. Pode ser usado para login e recuperação de senha.    |
| `password`       | `models.CharField`        | Gerenciado pelo Django (armazena o hash)            | Hash da senha do usuário. O Django gerencia a criptografia.                    |
| `first_name`     | `models.CharField`        | `max_length=150`, `blank=True`                      | Primeiro nome do usuário. Opcional.                                            |
| `last_name`      | `models.CharField`        | `max_length=150`, `blank=True`                      | Sobrenome do usuário. Opcional.                                                |
| `is_staff`       | `models.BooleanField`     | `default=False`                                     | Define se o usuário pode acessar o painel de administração do Django.          |
| `is_active`      | `models.BooleanField`     | `default=True`                                      | Define se a conta do usuário está ativa. Contas inativas não podem fazer login. |
| `date_joined`    | `models.DateTimeField`    | `default=timezone.now`                              | Data e hora em que a conta do usuário foi criada.                              |


#### Relacionamentos

| Nome do Atributo | Tipo de Campo Django         | Parâmetros                                                                                     | Descrição                                                                                             |
| :--------------- | :--------------------------- | :--------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------- |
| `library`        | `models.ManyToManyField`     | `to='books.Book'`, `through='books.UserBookAssociation'`, `related_name='users_in_library'`    | Relação muitos-para-muitos com `Book` que representa a biblioteca do usuário, com status de leitura. |

#### Métodos

| Assinatura do Método              | Visibilidade | Descrição                                        |
| :--------------------------------- | :----------- | :----------------------------------------------- |
| `def __str__(self) -> str:`        | pública      | Retorna o `username` do usuário.                 |

---

## 4. Modelos da Aplicação `books`

### 4.1. Classe: `Genre`

-   **Descrição:** Modela uma categoria ou gênero literário (ex: Ficção Científica, Fantasia).
-   **Herança:** `core.models.TimestampedModel`

#### Atributos (Campos)

| Nome do Atributo | Tipo de Campo Django | Parâmetros                                 | Descrição                    |
|:---------------|:---------------------|:-------------------------------------------|:-----------------------------|
| `name` | `models.CharField` | `max_length=100`, `unique=True`, `verbose_name="Nome"`| Nome único do gênero literário. |

#### Métodos

| Assinatura do Método              | Visibilidade | Descrição                |
| :--------------------------------- | :----------- | :----------------------- |
| `def __str__(self) -> str:`        | pública      | Retorna `self.name`.     |

### 4.2. Classe: `Tag`

-   **Descrição:** Modela uma palavra-chave ou "tag" que pode ser associada a um livro para fins de categorização mais granular.
-   **Herança:** `core.models.TimestampedModel`

#### Atributos (Campos)

| Nome do Atributo | Tipo de Campo Django | Parâmetros                                 | Descrição                  |
|:---------------|:---------------------|:-------------------------------------------|:---------------------------|
| `name` | `models.CharField` | `max_length=100`, `unique=True`, `verbose_name="Nome"`| Nome único da tag ou palavra-chave. |

#### Métodos

| Assinatura do Método              | Visibilidade | Descrição                |
| :--------------------------------- | :----------- | :----------------------- |
| `def __str__(self) -> str:`        | pública      | Retorna `self.name`.     |

### 4.3. Classe: `Book`

-   **Descrição:** Entidade central do sistema, representando um livro com suas informações básicas.
-   **Herança:** `core.models.TimestampedModel`

#### Atributos (Campos)

| Nome do Atributo | Tipo de Campo Django     | Parâmetros                                                                       | Descrição                                                                                           |
|:---------------|:-------------------------|:---------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------|
| `title` | `models.CharField`     | `max_length=255`, `verbose_name="Título"`                                      | Título oficial do livro.                                                                            |
| `author` | `models.CharField`     | `max_length=255`, `verbose_name="Autor"`                                       | Nome do autor ou autores do livro.                                                                  |
| `external_id` | `models.CharField`     | `max_length=100`, `unique=True`, `null=True`, `blank=True`, `verbose_name="ID Externo"` | Identificador único de uma API externa (ex: Google Books ID) para evitar duplicidade de livros. Opcional. |
| `synopsis` | `models.TextField`       | `null=True`, `blank=True`, `verbose_name="Sinopse"`                            | Resumo ou sinopse do livro. Opcional.                                                               |

#### Relacionamentos

| Nome do Atributo | Tipo de Campo Django       | Parâmetros                                           | Descrição                                                |
|:---------------|:-------------------------|:-----------------------------------------------------|:---------------------------------------------------------|
| `genres` | `models.ManyToManyField`   | `to='Genre'`, `related_name='books'`, `verbose_name="Gêneros"`| Relação muitos-para-muitos com os gêneros do livro.    |
| `tags` | `models.ManyToManyField`   | `to='Tag'`, `related_name='books'`, `verbose_name="Tags"`    | Relação muitos-para-muitos com as tags associadas ao livro. |

#### Métodos

| Assinatura do Método                        | Visibilidade | Descrição                                                           |
| :------------------------------------------- | :----------- | :------------------------------------------------------------------ |
| `def __str__(self) -> str:`                  | pública      | Retorna uma string no formato `"Título do Livro por Autor"`.       |
| `def get_average_rating(self) -> float:`     | pública      | `@property` que calcula e retorna a nota média das avaliações.      |


### 4.4. Classe: `Review`

-   **Descrição:** Representa a avaliação de um livro, contendo uma nota e um texto, feita por um usuário.
-   **Herança:** `core.models.TimestampedModel`

#### Atributos (Campos)

| Nome do Atributo| Tipo de Campo Django | Parâmetros | Descrição |
|:---|:---|:---|:---|
| `rating` | `models.IntegerField` | `validators=[MinValueValidator(1), MaxValueValidator(5)]`, `verbose_name="Nota"` | Nota da avaliação, restrita a um valor inteiro entre 1 e 5. |
| `text` | `models.TextField` | `null=True`, `blank=True`, `verbose_name="Resenha"` | Texto da resenha, de tamanho livre. Opcional. |

#### Relacionamentos

| Nome do Atributo| Tipo de Campo Django | Parâmetros | Descrição |
|:---|:---|:---|:---|
| `user` | `models.ForeignKey` | `to='users.User'`, `on_delete=models.CASCADE`, `related_name='reviews'`, `verbose_name="Usuário"` | Chave estrangeira para o usuário que fez a avaliação. Se o usuário for excluído, a avaliação também será. |
| `book` | `models.ForeignKey` | `to='Book'`, `on_delete=models.CASCADE`, `related_name='reviews'`, `verbose_name="Livro"` | Chave estrangeira para o livro que está sendo avaliado. Se o livro for excluído, a avaliação também será. |


#### Métodos e Meta

| Assinatura do Método | Visibilidade | Descrição |
| :--- | :--- | :--- |
| `def __str__(self) -> str:` | pública | Retorna `"Avaliação de [Usuário] para [Livro]"`. |

-   **`class Meta:`**
    -   `unique_together = ['user', 'book']`: Impede que um usuário avalie o mesmo livro mais de uma vez.

### 4.5. Classe: `UserBookAssociation`

-   **Descrição:** Modelo intermediário ("through model") que conecta `User` e `Book`, representando a "biblioteca" de um usuário e armazenando o status da leitura.
-   **Herança:** `core.models.TimestampedModel`

#### Enum de Status

```python
class StatusChoices(models.TextChoices):
    WANT_TO_READ = 'WANT_TO_READ', 'Quero Ler'
    READING = 'READING', 'Lendo'
    READ = 'READ', 'Lido'
```

#### Atributos (Campos)

| Nome do Atributo      | Tipo de Campo Django      | Parâmetros                                                                         | Descrição                                                                      |
|:----------------------|:--------------------------|:-----------------------------------------------------------------------------------|:-------------------------------------------------------------------------------|
| `status`              | `models.CharField`        | `max_length=20`, `choices=StatusChoices.choices`, `default=StatusChoices.WANT_TO_READ`| Status da leitura do livro pelo usuário (ex: 'Lido', 'Lendo', 'Quero Ler'). |

#### Relacionamentos

| Nome do Atributo | Tipo de Campo Django | Parâmetros | Descrição |
|:---------------|:---------------------|:--------------------------------------------------------------------------------------------|:---|
| `user` | `models.ForeignKey` | `to='users.User'`, `on_delete=models.CASCADE`, `related_name='library_associations'` | Chave estrangeira para o usuário. |
| `book` | `models.ForeignKey` | `to='Book'`, `on_delete=models.CASCADE`, `related_name='library_associations'` | Chave estrangeira para o livro. |

---

## 5. Classes de Serviço

### 5.1. Classe: `RecommendationService`

-   **Descrição:** Classe não persistida, responsável por encapsular a lógica de negócio para geração de recomendações de livros.
-   **Atributos:** Nenhum
-   **Métodos:**

| Assinatura do Método | Retorno | Descrição |
|:---|:---|:---|
| `def get_recommendations(self, user: 'User') -> QuerySet['Book']:` | `QuerySet` de `Book` | Gera e retorna uma lista de livros recomendados para um determinado usuário, com base em seu histórico, avaliações e gêneros de preferência. |

## Bibliografia

## Autores

| Nome                      |
|---------------------------|
| [Bruno Bragaça](https://github.com/BrunoBReis) |
| [Gabriel Castelo](https://github.com/GabrielCastelo-31)   |
| [Pedro Braga](https://github.com/Stain19) |
| [Renan Vieira](https://github.com/R-enanVieira) |

## Histórico de Versionamento

| Versão | Data  | Descrição | Autor(es) | Revisor(es) |
|--------|-------|-----------|-----------|-------------|
|  `1.0` | 17/09 | Adiciona descricao de classes e respectivos atributos e metodos | [Pedro Braga](https://github.com/Stain19), [Gabriel Castelo](https://github.com/GabrielCastelo-31) e [Renan Vieira](https://github.com/R-enanVieira) | [Bruno Bragaça](https://github.com/BrunoBReis) |
